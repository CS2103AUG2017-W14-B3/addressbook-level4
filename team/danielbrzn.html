<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Daniel Berzin Chua Yuan Siang - Project Portfolio</title>
<link rel="stylesheet" href="../stylesheets/gh-pages.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../stylesheets/coderay-asciidoctor.css">
</head>
<body class="article">
<div id="header">
<h1>Daniel Berzin Chua Yuan Siang - Project Portfolio</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="project-hitmeup"><a class="link" href="#project-hitmeup">Project: HitMeUp</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>HitMeUp is an address book application designed with the sociable user in mind. It aims to provide a one stop solution for every need: To contact, keep up
and organise.
With the cloud import feature, a user would be able to get the application
up and running a matter of minutes. Being able to group your contacts, and view each group at a glance affords
convenience like never before. Social integration to Instagram and Twitter is baked in, allowing users to view profiles
in the application itself without having to switch to a browser or check their phone.</p>
</div>
<div class="paragraph">
<p><strong>Code contributed</strong>: [<a href="https://github.com/CS2103AUG2017-W14-B3/main/tree/master/collated/main/danielbrzn.md">Functional code</a>] [<a href="https://github.com/CS2103AUG2017-W14-B3/main/tree/master/collated/test/danielbrzn.md">[Test code</a>]</p>
</div>
<div class="sect2">
<h3 id="enhancement-added-google-contacts-import"><a class="link" href="#enhancement-added-google-contacts-import">Enhancement Added: Google Contacts Import</a></h3>
<div class="sect3">
<h4 id="external-behavior"><a class="link" href="#external-behavior">External behavior</a></h4>
<hr>
<div class="paragraph">
<p><mark>Start of Extract [from: User Guide]</mark></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="importing-contacts-code-import-code"><a class="link" href="#importing-contacts-code-import-code">Importing contacts : <code>import</code></a></h3>
<div class="paragraph">
<p>Allows you to import contacts from either Google Contacts.</p>
</div>
<div class="paragraph">
<p>Format: <code>import SERVICE_NAME</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The service name can only be "Google"</p>
</li>
<li>
<p>The service name is case-insensitive.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>import google</code><br></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Opens the Google authentication page (as shown below) in HitMeUp to grant the app access to your contacts.</p>
<div class="imageblock">
<div class="content">
<img src="../images/HitMeUpImportStep1.png" alt="HitMeUpImportStep1" width="790">
</div>
</div>
<div class="paragraph">
<p><em>Figure 3.11.1 Google Authentication Page</em></p>
</div>
</li>
<li>
<p>Once you have logged in with your credentials, the consent page below will be loaded:</p>
<div class="imageblock">
<div class="content">
<img src="../images/HitMeUpImportStep2.png" alt="HitMeUpImportStep2" width="790">
</div>
</div>
<div class="paragraph">
<p><em>Figure 3.11.2 Google Consent Page</em></p>
</div>
</li>
<li>
<p>After granting access, HitMeUp will display a progress bar (as shown below) to indicate the progress of import.</p>
<div class="imageblock">
<div class="content">
<img src="../images/HitMeUpImportStep3.png" alt="HitMeUpImportStep3" width="790">
</div>
</div>
<div class="paragraph">
<p><em>Figure 3.11.3 HitMeUp Import Progress</em></p>
</div>
</li>
<li>
<p>After import has completed, the application will show the number of contacts successfully imported and the names of contacts that were
unable to be imported.</p>
<div class="imageblock">
<div class="content">
<img src="../images/HitMeUpImportStep4.png" alt="HitMeUpImportStep4" width="790">
</div>
</div>
<div class="paragraph">
<p><em>Figure 3.11.4 Import Result Display</em></p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><mark>End of Extract</mark></p>
</div>
<hr>
<div class="sect3">
<h4 id="justification"><a class="link" href="#justification">Justification</a></h4>
<div class="paragraph">
<p>{Justify the need for, and the current design (i.e. external behavior) of, the feature}</p>
</div>
</div>
<div class="sect3">
<h4 id="implementation"><a class="link" href="#implementation">Implementation</a></h4>
<hr>
<div class="paragraph">
<p><mark>Start of Extract [from: Developer Guide]</mark></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="import-mechanism"><a class="link" href="#import-mechanism">Import mechanism</a></h3>
<div class="paragraph">
<p>The import mechanism is facilitated by Google&#8217;s People API. It supports reading up to 1000 contacts from the user&#8217;s personal Google account and parsing them into a format that can be added to the address book. The import mechanism only supports
adding contacts from Google but iCloud import is scheduled for release in a later version of the application.</p>
</div>
<div class="paragraph">
<p>Before any importing can be done, HitMeUp to be authorized to request data from Google&#8217;s API. This is done using the OAuth 2.0 protocol as it is the standard used by Google for the People API.
As there are libraries from Google that handle authorization, these libraries have been used in the implementation of the import mechanism.</p>
</div>
<div class="paragraph">
<p>Client information such as the Client ID and Client secret are first loaded into a <code>GoogleClientSecrets</code> object. The client secrets are stored in a JSON file and since the executable will be distributed to users, as per
<a href="https://developers.google.com/identity/protocols/OAuth2InstalledApp">Google&#8217;s OAuth documentation</a>, the client secrets are not treated as a secret in this context. After which, A <code>GoogleAuthorizationCodeFlow</code> object is set up
using the <code>GoogleClientSecrets</code>, <code>HttpTransport</code>, <code>JsonFactory</code> objects and the scope of access desired to the user&#8217;s Google Contacts data. In this implementation, we have chosen read-only as we are only importing
contacts and no modification to the user&#8217;s data on Google will be performed. An <code>AuthorizationUtil</code> object is then created using the previously mentioned <code>GoogleAuthorizationCodeFlow</code> object, and also a <code>LocalServerReceiver</code> object which allows the application to listen on the local
web server for the authorization code that is provided when the user gives consent to access his/her data. The <code>AuthorizationUtil</code> inherits from <code>AuthorizationCodeInstalledApp</code> as the <code>browse</code> method was modified to allow for the authorization
URL to be opened in the <code>BrowserPanel</code>.</p>
</div>
<div class="paragraph">
<p>After which, the authorization flow can finally begin. The following sequence diagram illustrates this process.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://developers.google.com/accounts/images/webflow.png" alt="webflow" width="377">
</div>
</div>
<div class="paragraph">
<p>(Diagram from: <a href="https://developers.google.com/identity/protocols/OAuth2" class="bare">https://developers.google.com/identity/protocols/OAuth2</a>, reused under Creative Commons Attribution 3.0 License)</p>
</div>
<div class="paragraph">
<p>A token is first requested by invoking the <code>authorize</code> method from <code>GoogleUtil</code> where an <code>AuthorizationUtil</code> loads the page for the user to login to his/her Google account in the <code>BrowserPanel</code>.
Once the user provides consent for the address book to access the data, an authorization code is sent back to the <code>LocalServerReceiver</code> object and passed on to the <code>GoogleAuthorizationCodeFlow</code>
object so that the code can be exchanged for a token. Once the token is received, a <code>Credential</code> object is created and returned to the <code>executeUndoableCommand</code> method.</p>
</div>
<div class="paragraph">
<p>The Credential object is then passed to a <code>retrieveContacts</code> method from <code>GoogleUtil</code> that creates a <code>PeopleService</code> object that allows the application to interact with Google&#8217;s People API.
The parameters used to get the list of the user&#8217;s connections (Google&#8217;s term for contacts) are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PageSize: 1000
PersonFields: Names, EmailAddresses, PhoneNumbers, Addresses, Birthdays</pre>
</div>
</div>
<div class="paragraph">
<p>A PageSize (the number of connections to fetch) of 1000 is chosen as it is the amount of contacts that the address book should be able to hold before it gets sluggish.
The PersonFields chosen are the ones most relevant to storing a contact in HitMeUp.</p>
</div>
<div class="paragraph">
<p><code>retrieveContacts</code> will then pass the <code>List&lt;Person&gt;</code> of connections back to the caller and finally, the <code>importContacts</code> method will be called on the <code>List&lt;Person&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Refer to the code example below for implementation of the <code>importContacts</code> method:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code listing:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
  * Imports contacts into the application using the given {@code List&lt;Person&gt;}
  */</span>
    <span class="directive">public</span> <span class="type">void</span> importContacts(<span class="predefined-type">List</span>&lt;Person&gt; connections) {

        Task&lt;<span class="predefined-type">Void</span>&gt; task = <span class="keyword">new</span> Task&lt;<span class="predefined-type">Void</span>&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> <span class="predefined-type">Void</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {

                <span class="type">int</span> amountToAdd = connections.size();
                invalidPeople = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;();
                <span class="keyword">for</span> (Person person : connections) {
                    seedu.address.model.person.Person toAdd = GoogleUtil.convertPerson(person);
                    <span class="keyword">if</span> (toAdd == <span class="predefined-constant">null</span>) {
                        invalidPeople.add(person.getNames().get(FIRST_PERSON_INDEX).getDisplayName());
                        <span class="keyword">continue</span>;
                    }
                    <span class="keyword">try</span> {
                        model.addPerson(toAdd);
                        peopleAdded++;
                    } <span class="keyword">catch</span> (DuplicatePersonException e) {
                        e.printStackTrace();
                    }
                    updateProgress(peopleAdded, amountToAdd);
                }
                <span class="keyword">return</span> <span class="predefined-constant">null</span>;
            }
        };

        <span class="comment">// housekeeping code for the start/end of the Task</span>
    }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>importContacts</code> method is implemented using the <code>Task</code> class from JavaFX and takes care of importing contacts to the address book. <code>importContacts</code> is run in a separate <code>Thread</code> from the main program.
It parses every connection from the <code>List&lt;Person&gt;</code> using a <code>convertPerson</code> method in <code>GoogleUtil</code> that converts a <code>Person</code> object to a <code>seedu.address.model.person.Person</code> such that it can be added to the address book.
A progress bar for importing is also shown to the user, implemented using the <code>progressProperty()</code> method of the <code>Task</code> class.</p>
</div>
<div class="paragraph">
<p>The following sequence diagram shows how the import operation works:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ImportSequenceDiagram.png" alt="ImportSequenceDiagram" width="800">
</div>
</div>
<div class="paragraph">
<p>The import mechanism is built upon an <code>UndoableCommand</code>, which means that any changes made by the command can be easily reversed by calling the
<code>undo</code> command.</p>
</div>
<div class="sect3">
<h4 id="design-considerations"><a class="link" href="#design-considerations">Design Considerations</a></h4>
<div class="paragraph">
<p><strong>Aspect:</strong> How import executes<br>
<strong>Alternative 1 (current choice):</strong> Individually adds each contact.<br>
<strong>Pros:</strong> User is able to see each contact being added.<br>
<strong>Cons:</strong> Slower than adding retrieved contacts all at once as the data has to be written to disk every time a contact is added individually<br>
<strong>Alternative 2:</strong> Contacts are only added after every single <code>Person</code> is parsed<br>
<strong>Pros:</strong> Faster than adding as soon as each <code>Person</code> is parsed as data is written all at once, instead of multiple times<br>
<strong>Cons:</strong> Requires a new method <code>addAllInList</code> to be implemented in model, which only has limited use as import is the only command doing a batch
addition of contacts</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Aspect:</strong> How import progress is shown to the user<br>
<strong>Alternative 1 (current choice):</strong> Show a pop-up progress window indicating how many contacts have been added<br>
<strong>Pros:</strong> Intuitive for the user to understand<br>
<strong>Cons:</strong> Difficult to implement as importing contacts takes a (relatively) long time and thus, blocks the JavaFX thread from updating the UI in a timely manner. As such, the progress bar will not be updated until the <code>importContacts</code> function is completed.
Threading has to be used to allow the progress bar to update as the <code>importContacts</code> method is running.<br>
<strong>Alternative 2:</strong> Show the user how many contacts have been added in <code>ResultDisplay</code> <br>
<strong>Pros:</strong> Easy to implement as no new UI elements have to be added<br>
<strong>Cons:</strong> Not as user-friendly as having a progress bar<br></p>
</div>
<hr>
<div class="paragraph">
<p><strong>Aspect:</strong> Implementation of authorization<br>
<strong>Alternative 1 (current choice):</strong> Use the <code>BrowserPanel</code> to show the authorization page<br>
<strong>Pros:</strong> Clearer for the user to understand and focus is kept on the main application.<br>
<strong>Cons:</strong> Requires implementing a new class as modification to the existing classes provided by the Google Libraries is needed to allow for the<br>
authorization URL to be shown in the <code>BrowserPanel</code><br>
<strong>Alternative 2 :</strong> Pop-up the authorization page in the user&#8217;s default browser<br>
<strong>Pros:</strong> Easy for the user to authorize as they may already be logged in to their Google account on their browsers.<br>
<strong>Cons:</strong> Takes the focus away from the main application to the user&#8217;s default browser, which may be a jarring user experience.<br></p>
</div>
<div class="paragraph">
<p><mark>End of Extract</mark></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="enhancement-proposed-to-be-updated"><a class="link" href="#enhancement-proposed-to-be-updated">Enhancement Proposed: to be updated</a></h3>

</div>
<div class="sect2">
<h3 id="other-contributions"><a class="link" href="#other-contributions">Other contributions</a></h3>
<div class="ulist">
<ul>
<li>
<p>Added alias command (Pull requests <a href="https://github.com/CS2103AUG2017-W14-B3/main/pull/19">#19</a>, <a href="https://github.com/CS2103AUG2017-W14-B3/main/pull/21">#21</a>)</p>
</li>
<li>
<p>Made fields other than person name and phone number optional (Pull request <a href="https://github.com/CS2103AUG2017-W14-B3/main/pull/71">#71</a>)</p>
</li>
<li>
<p>Added fields for Instagram and Twitter accounts (Pull request <a href="https://github.com/CS2103AUG2017-W14-B3/main/pull/85">#85</a>)</p>
</li>
<li>
<p>Responsible for managing weekly milestones and releases</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-11-12 18:27:13 +00:00
</div>
</div>
</body>
</html>